# shiki Configuration Example - exec Backend (Docker)
# =====================================================
# 
# このファイルは Docker コンテナ環境向けの shiki 設定例です。
# systemd が動作しない環境で複数サービスを管理する場合に使用します。
#
# 詳細は docs/CONFIGURATION.md を参照してください。

# ------------------------------------------------------------------------------
# HTTP サーバー設定
# ------------------------------------------------------------------------------
server:
  bind: "0.0.0.0"
  port: 8080

# ------------------------------------------------------------------------------
# 認証設定
# ------------------------------------------------------------------------------
auth:
  enabled: false
  method: "token"
  token: ""

# ------------------------------------------------------------------------------
# ログ設定
# ------------------------------------------------------------------------------
logging:
  level: "info"
  format: "json"
  output: "stdout"

# ------------------------------------------------------------------------------
# エージェント設定
# ------------------------------------------------------------------------------
agent:
  name: "docker-container"
  mode: "standalone"
  backend: "exec"  # 任意コマンドでサービス操作
  tags:
    - "docker"
    - "multi-service"

# ------------------------------------------------------------------------------
# サービス定義（exec バックエンド用）
# ------------------------------------------------------------------------------
# 各サービスに対して start/stop/status コマンドを定義します。
# status コマンドは終了コード 0 = running、それ以外 = stopped として判定されます。

services:
  # nginx サービス
  nginx:
    start: "/usr/sbin/nginx"
    stop: "/usr/sbin/nginx -s quit"
    status: "pgrep -x nginx"
  
  # Redis サービス
  redis:
    start: "/usr/bin/redis-server /etc/redis.conf --daemonize yes"
    stop: "/usr/bin/redis-cli shutdown"
    status: "/usr/bin/redis-cli ping"
  
  # カスタムアプリケーション
  myapp:
    start: "/app/start.sh"
    stop: "/app/stop.sh"
    status: "/app/health.sh"
    working_dir: "/app"
    env:
      - "DATABASE_URL=postgres://db:5432/mydb"
      - "REDIS_URL=redis://localhost:6379"
      - "LOG_LEVEL=info"

# ------------------------------------------------------------------------------
# リトライ設定
# ------------------------------------------------------------------------------
retry:
  max_attempts: 3
  delay_ms: 1000
  backoff_factor: 2.0
  max_delay_ms: 30000

# ------------------------------------------------------------------------------
# タイムアウト設定
# ------------------------------------------------------------------------------
timeout:
  connect_seconds: 5
  read_seconds: 30
  service_seconds: 60
